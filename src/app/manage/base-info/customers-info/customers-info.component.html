<div class="wrap">
    <!-- -------- 表格操作 -------- -->
    <div class="table-operations">
        <div nz-row nzGutter="16">
            <div nz-col class="gutter-row" nzSpan="10">
                <!-- 面包屑导航 -->
                <app-breadcrumbs [options]="breadcrumbs"></app-breadcrumbs>
            </div>
            <div nz-col class="gutter-row" nzSpan="8" nzOffset="2">
                <!--<div class="table-search">
                    <nz-input-group nzSearch
                                    nzCompact
                                    nzSize="default">
                        <nz-select id="anti-select"
                                   style="min-width: 32px;"
                                   [nzSize]="'default'"
                                   [nzDropdownMatchSelectWidth]="false"
                                   [(ngModel)]="keywordType">
                            <nz-option nzValue="name" nzLabel="名称"></nz-option>
                            <nz-option nzValue="address" nzLabel="地址"></nz-option>
                            <nz-option nzValue="username" nzLabel="账号"></nz-option>
                            <nz-option nzValue="createTime" nzLabel="等级时间"></nz-option>
                            <nz-option nzValue="contactName" nzLabel="联系人"></nz-option>
                            <nz-option nzValue="mobilePhone" nzLabel="联系电话"></nz-option>
                        </nz-select>
                        <input type="text" nz-input placeholder="键入关键字, 按ENTER搜索" [(ngModel)]="keyword"
                               style="width: 60%;" (keyup)="$event.which === 13 && onKeywordSearch($event, keywordType)">
                    </nz-input-group>
                </div>-->
            </div>
            <div nz-col class="gutter-row" nzSpan="4">
                <!-- CUDE: create,update,delete,export -->
                <div class="table-CUDE">
                    <button nz-button
                            (click)="onAdd()"
                            nzType="default"
                            nzShape="circle"
                            nzTitle="添加"
                            nzPlacement="topCenter"
                            nz-tooltip>
                        <i class="anticon anticon-plus-circle-o"></i>
                    </button>
                    &nbsp;
                    <button nz-button
                            [disabled]="!formCache"
                            (click)="onEdit()"
                            nzType="default"
                            nzShape="circle"
                            nzTitle="编辑"
                            nzPlacement="topCenter"
                            nz-tooltip>
                        <i class="anticon anticon-edit"></i>
                    </button>
                    &nbsp;
                    <button nz-button
                            nz-popconfirm
                            nzTitle="确认删除该信息吗?"
                            (nzOnConfirm)="onDel()"
                            [disabled]="!formCache"
                            nzType="default"
                            nzShape="circle"
                            nzPlacement="topCenter"
                            nz-tooltip>
                        <i class="anticon anticon-minus-circle-o"></i>
                    </button>
                    &nbsp;
                    <button nz-button
                            (click)="onExp()"
                            nzType="default"
                            nzShape="circle"
                            nzTitle="导出"
                            nzPlacement="topCenter"
                            nz-tooltip>
                        <i class="anticon anticon-file-excel"></i>
                    </button>
                    &nbsp;
                </div>
            </div>
        </div>
    </div>
    <!-- -------- 表格内容 -------- -->
    <div class="table-content">
        <nz-spin [nzSize]="'large'" [nzSpinning]="isSpinning">
            <nz-table #nzTable
                      [nzScroll]="{x: '2000px'}"
                      [nzData]="list_options.rows"
                      [nzFrontPagination]="false"
                      [nzTotal]="pageRes.total"
                      [nzPageIndex]="pageRes.page"
                      [nzPageSize]="pageRes.size"
                      (nzPageIndexChange)="onPageV2($event)"
                      (nzPageSizeChange)="onPageV2($event)">
                <thead>
                <tr>
                    <th></th>
                    <th>
                        <div></div>
                    </th><!-- 此th与下面的th(全选)互斥,当前先不实现全选 -->
                    <!--<th nzShowCheckbox [(nzChecked)]="allChecked" [nzIndeterminate]="indeterminate" (nzCheckedChange)="checkAll($event)"></th>-->
                    <th>类型</th>
                    <th>定位</th>
                    <th>图片</th>
                    <th nzCustomFilter>名称 <br/>
                        <input type="text" nz-input placeholder=""
                               nzSize="small" style="width: 60%;"
                               [(ngModel)]="keyword.name"
                               (keyup)="$event.which === 13 && onKeywordSearchTh('name')">
                    </th>
                    <th>所属区域</th>
                    <th>收运时间段</th>
                    <th>地址 <br/>
                        <input type="text" nz-input placeholder=""
                               nzSize="small" style="width: 60%;"
                               [(ngModel)]="keyword.address"
                               (keyup)="$event.which === 13 && onKeywordSearchTh('address')">
                    </th>
                    <th>账号 <br/>
                        <input type="text" nz-input placeholder=""
                               nzSize="small" style="width: 60%;"
                               [(ngModel)]="keyword.username"
                               (keyup)="$event.which === 13 && onKeywordSearchTh('username')">
                    </th>
                    <th>派桶数</th>
                    <th nzShowSort [(nzSort)]="sortMap.createTime"
                        (nzSortChange)="onSortTh('createTime',$event)">登记时间 <br/>
                        <input type="text" nz-input placeholder=""
                               nzSize="small" style="width: 60%;"
                               [(ngModel)]="keyword.createTime"
                               (keyup)="$event.which === 13 && onKeywordSearchTh('createTime')">
                    </th>
                    <th>联系人 <br/>
                        <input type="text" nz-input placeholder=""
                               nzSize="small" style="width: 60%;"
                               [(ngModel)]="keyword.contactName"
                               (keyup)="$event.which === 13 && onKeywordSearchTh('contactName')">
                    </th>
                    <th>联系电话 <br/>
                        <input type="text" nz-input placeholder=""
                               nzSize="small" style="width: 60%;"
                               [(ngModel)]="keyword.mobilePhone"
                               (keyup)="$event.which === 13 && onKeywordSearchTh('mobilePhone')">
                    </th>
                </tr>
                </thead>
                <tbody>
                <ng-template ngFor let-data [ngForOf]="nzTable.data">
                    <tr *ngIf="data.level === 0" (click)="onClickTr($event, data)">
                        <td [nzShowExpand]="!!data.customerList" [(nzExpand)]="data.expand"
                            (nzExpandChange)="collapse(expandDataCache[data.id], data, $event)"></td>
                        <td nzShowCheckbox [(nzChecked)]="data.checked" [nzDisabled]="data.disabled"
                            (nzCheckedChange)="onCheckedChange($event, data)"></td>
                        <td>{{data.level ? '子收集点' : (data.customerList ? '聚类点' : '普通点')}}</td>
                        <td>{{data.lngLat ? '有' : '无'}}</td>
                        <td>{{data.images.length || '空'}}</td>
                        <td>{{data.name || '空'}}</td>
                        <td>{{data.countyName || '空'}}</td>
                        <td>{{data.duration || '空'}}</td>
                        <td>{{data.detailAddress || '空'}}</td>
                        <td>{{data.username || '空'}}</td>
                        <td>{{data.totalDustbins || '空'}}</td>
                        <td>{{data.createTime | date:'yyyy-MM-dd' || '空'}}</td>
                        <td>{{data.contactName || '空'}}</td>
                        <td>{{data.mobilePhone || '空'}}</td>
                    </tr>
                    <ng-template *ngIf="data.expand" ngFor let-item [ngForOf]="data.customerList">
                        <tr  (click)="onClickTr($event, item)">
                            <td></td>
                            <td nzShowCheckbox [(nzChecked)]="item.checked" [nzDisabled]="item.disabled"
                                (nzCheckedChange)="onCheckedChange($event, item)"></td>
                            <td>{{item.level ? '子收集点' : (item.customerList ? '聚类点' : '普通点')}}</td>
                            <td>{{item.lngLat ? '有' : '无'}}</td>
                            <td>{{item.images.length || '空'}}</td>
                            <td>{{item.name || '空'}}</td>
                            <td>{{item.countyName || '空'}}</td>
                            <td>{{item.duration || '空'}}</td>
                            <td>{{item.detailAddress || '空'}}</td>
                            <td>{{item.username || '空'}}</td>
                            <td>{{item.totalDustbins || '空'}}</td>
                            <td>{{item.createTime | date:'yyyy-MM-dd' || '空'}}</td>
                            <td>{{item.contactName || '空'}}</td>
                            <td>{{item.mobilePhone || '空'}}</td>
                        </tr>
                    </ng-template>

                </ng-template>
                </tbody>
            </nz-table>
        </nz-spin>
    </div>
</div>