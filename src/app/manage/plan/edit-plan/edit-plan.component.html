<div class="wrap">
    <!-- -------- 表格操作 -------- -->
    <div class="table-operations">
        <div nz-row nzGutter="16">
            <div nz-col nzSpan="10">
                <!-- 面包屑导航 -->
                <app-breadcrumbs [options]="breadcrumbs"></app-breadcrumbs>
            </div>
            <div nz-col nzSpan="6" nzOffset="8">
                <!-- CUDE: create,update,delete,export -->
                <div class="table-CUDE">
                    <button nz-button
                            nzType="default"
                            nzShape="circle"
                            nzTitle="保存"
                            nzPlacement="topCenter"
                            nz-tooltip>
                        <i nz-icon type="save" theme="outline"></i>
                    </button>
                    &nbsp;
                    <button nz-button
                            nzType="default"
                            nzShape="circle"
                            nzTitle="方案预测"
                            nzPlacement="topCenter"
                            nz-tooltip>
                        <i nz-icon type="bar-chart" theme="outline"></i>
                    </button>
                    &nbsp;
                    &nbsp;
                </div>
            </div>
        </div>
    </div>
    <!-- -------- 表格内容 -------- -->
    <div class="table-content">
        <div nz-row nzGutter="16">


            <!-- ******** 路线 start ******** -->
            <div nz-col nzSpan="7">
                <div class="inner-table-opt">
                    <div nz-row>
                        <div nz-col nzSpan="4" class="inner-table-title">
                            <i nz-icon class="anticon anticon-environment location"></i>
                            路线
                        </div>
                        <div nz-col nzSpan="19" nzOffset="1" class="inner-table-btns">
                            <button nz-button
                                    nzType="default"
                                    (click)="isAddRouteFormVisible = true">
                                新增
                            </button>
                            &nbsp;
                            <button nz-button
                                    nzType="default"
                                    (click)="onSelectVehicle()">
                                选择车辆
                            </button>
                            &nbsp;
                            <button nz-button
                                    nz-popconfirm
                                    nzTitle="删除"
                                    (nzOnConfirm)="onDelRoute()"
                                    nzType="default"
                                    nzPlacement="topCenter">
                                删除
                            </button>
                            &nbsp;
                        </div>
                    </div>
                </div>
                <nz-spin [nzSize]="'large'" [nzSpinning]="isRoutesSpinning">
                    <nz-table #routesTable
                              [nzData]="routeListCache"
                              [nzScroll]="{ x: '450px', y: '500px' }"
                              [nzFrontPagination]="false"
                              [nzShowPagination]="false">
                        <thead>
                        <tr>
                            <!--<th nzWidth="62px"></th>&lt;!&ndash; 此表头为checkbox &ndash;&gt;-->
                            <th nzWidth="50px">
                                锁定
                            </th>
                            <th nzWidth="100px">
                                路线名称
                            </th>
                            <th nzWidth="80px">
                                车牌号
                            </th>
                            <th nzWidth="50px">
                                优先级
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let item of routeListCache; index as i"
                            [ngClass]="{ 'table-row-selected': item.checked }"
                            (click)="onSelectRoute($event, item)">
                            <!--<td nzShowCheckbox [(nzChecked)]="item.checked"
                                (nzCheckedChange)="onSelected($event, item)"></td>-->
                            <td>
                                <i nz-icon type="lock" theme="outline" style="cursor: pointer;"
                                   *ngIf="item.lock">
                                </i>
                                <i nz-icon type="unlock" theme="outline" style="cursor: pointer;"
                                   *ngIf="!item.lock">
                                </i>
                            </td>
                            <td>{{item.name}}</td>
                            <td>{{item.plateNumber}}</td>
                            <td>{{item.priority}}</td>
                        </tr>
                        </tbody>
                    </nz-table>
                </nz-spin>
            </div>
            <!--    新增路线    -->
            <nz-drawer
                    [nzPlacement]="'left'"
                    [nzWidth]="400"
                    [nzClosable]="true"
                    [nzVisible]="isAddRouteFormVisible"
                    nzTitle="新建路线"
                    (nzOnClose)="onCloseAddRouteForm()">
                <form nz-form #routeForm="ngForm">
                    <nz-form-item>
                        <nz-form-label [nzSpan]="7" nzFor="route-name-new">路线名称</nz-form-label>
                        <nz-form-control [nzSpan]="17">
                            <input nz-input
                                   name="route-name-new"
                                   required
                                   type="text"
                                   id="route-name-new"
                                   [ngModel]="formDataRoute.name">
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item>
                        <nz-form-control [nzSpan]="8" [nzOffset]="7">
                            <button nz-button
                                    nzType="primary"
                                    [disabled]="!routeForm.valid"
                                    (click)="onAddRoute()">确认
                            </button>
                        </nz-form-control>
                    </nz-form-item>
                </form>
            </nz-drawer>
            <!-- ******** 路线 end ******** -->


            <!-- ******** 已派发 start ******** -->
            <div nz-col nzSpan="7">
                <div class="inner-table-opt">
                    <div nz-row>
                        <div nz-col nzSpan="7" class="inner-table-title">
                            <i nz-icon class="anticon anticon-check location"></i>
                            已派发
                        </div>
                        <div nz-col nzSpan="16" nzOffset="1" class="inner-table-btns">
                            <button nz-button
                                    nz-popconfirm
                                    nzTitle="确认取消派发?"
                                    (nzOnConfirm)="onCancelDistribute()"
                                    nzType="default"
                                    nzPlacement="topCenter">
                                取消派发
                            </button>
                            &nbsp;
                        </div>
                    </div>
                </div>
                <nz-spin [nzSize]="'large'" [nzSpinning]="isDistributeSpinning">
                    <nz-table #distributeTable
                              [nzData]="distributedListCache"
                              [nzScroll]="{ y: '500px' }"
                              [nzFrontPagination]="false"
                              [nzTotal]="pageRes.total"
                              [nzPageIndex]="pageRes.page"
                              [nzPageSize]="pageRes.size"
                              (nzPageIndexChange)="onPage($event)"
                              (nzPageSizeChange)="onPage($event)">
                        <thead>
                        <tr>
                            <th nzWidth="62px"></th><!-- 此表头为checkbox -->
                            <th nzWidth="70px">
                                名称
                            </th>
                            <th nzWidth="100px">
                                收运时间
                            </th>
                            <th nzWidth="100px">
                                收运量
                            </th>
                            <th nzWidth="100px">
                                状态
                            </th>
                        </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </nz-table>
                </nz-spin>
            </div>
            <!-- ******** 已派发 end ******** -->


            <!-- ******** 请求 start ******** -->
            <div nz-col nzSpan="10">
                <div class="inner-table-opt">
                    <div nz-row>
                        <div nz-col nzSpan="4" class="inner-table-title">
                            <i nz-icon class="anticon anticon-to-top location"></i>
                            收运请求
                        </div>
                        <div nz-col nzSpan="19" nzOffset="1" class="inner-table-btns">
                            <button nz-button
                                    nzType="default"
                                    (click)="onAddDemand()">
                                新增
                            </button>
                            &nbsp;
                            <button nz-button
                                    nz-popconfirm
                                    nzTitle="确认删除该请求?"
                                    (nzOnConfirm)="onDelDemand()"
                                    nzType="default"
                                    nzPlacement="topCenter">
                                删除
                            </button>
                            &nbsp;
                            <button nz-button
                                    nzType="default">
                                规划
                            </button>
                            &nbsp;
                            <button nz-button
                                    nzType="default">
                                派发
                            </button>
                            &nbsp;
                        </div>
                    </div>
                </div>
                <nz-spin [nzSize]="'large'" [nzSpinning]="isDemandSpinning">
                    <nz-table #demandTable
                              [nzData]="demandListCache"
                              [nzScroll]="{ x: '900px', y: '500px' }"
                              [nzFrontPagination]="false"
                              [nzTotal]="pageRes.total"
                              [nzPageIndex]="pageRes.page"
                              [nzPageSize]="pageRes.size"
                              (nzPageIndexChange)="onPage($event)"
                              (nzPageSizeChange)="onPage($event)">
                        <thead>
                        <tr>
                            <th nzWidth="50px"></th>   <!-- 是否展示子列表按钮 -->
                            <th nzWidth="200px" nzCustomFilter>
                                名称
                                <br/>
                                <input type="text" nz-input placeholder=""
                                       nzSize="small" style="width: 60%;"
                                       [(ngModel)]="params.demand.name"
                                       (keyup)="$event.which === 13 && getDemandList()">
                            </th>
                            <th nzWidth="120px">
                                收运时间
                            </th>
                            <th nzWidth="120px">
                                收运量
                            </th>
                            <th nzWidth="120px">
                                日期类型
                            </th>
                            <th nzWidth="120px">
                                超时等级
                            </th>
                            <th nzWidth="120px">
                                指定车辆
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <ng-template ngFor let-item [ngForOf]="demandListCache">
                            <tr [ngClass]="{ 'table-row-selected': item.checked }"
                                (click)="onSelectDemand($event, item)">
                                <td [nzShowExpand]="item.subTaskList && item.subTaskList.length > 0"
                                    [(nzExpand)]="item.expand"
                                    (nzExpandChange)="onCollapse(item, $event)" (click)="onCollapseStopPro($event)"></td>
                                <td>{{item.name}}</td>
                                <td>收运时间TODO</td>
                                <td>
                                    <nz-input-number [(ngModel)]="item.amountOfGarbage"
                                                     [nzSize]="'small'"
                                                     [nzMin]="0"
                                                     [nzStep]="0.1">
                                    </nz-input-number>
                                </td>
                                <td>日期类型TODO</td>
                                <td>超时等级TODO</td>
                                <td>{{item.vehiclePlate}}</td>
                            </tr>
                            <ng-template *ngIf="item.expand" ngFor let-child [ngForOf]="item.subTaskList">
                                <tr [ngClass]="{ 'table-row-selected': child.checked }"
                                    (click)="onSelectDemand($event, child, item)">
                                    <td></td>
                                    <td>{{child.name}}</td>
                                    <td>收运时间TODO</td>
                                    <td>
                                        <nz-input-number [(ngModel)]="child.amountOfGarbage"
                                                         [nzSize]="'small'"
                                                         [nzMin]="0"
                                                         [nzStep]="0.1"
                                                         [nzPrecision]="0.1">
                                        </nz-input-number>
                                    </td>
                                    <td>日期类型TODO</td>
                                    <td>超时等级TODO</td>
                                    <td></td>
                                </tr>
                            </ng-template>
                        </ng-template>
                        </tbody>
                    </nz-table>
                </nz-spin>
            </div>
            <!-- ******** 请求 start ******** -->
        </div>
    </div>
</div>
